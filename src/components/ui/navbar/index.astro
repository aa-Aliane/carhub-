---
// This is your index.astro inside components/ui/navbar/
import styles from './Navbar.module.css';
---

<nav class={styles.navbar}>
  <div class={styles.logo}>
    <svg width="180" height="28" viewBox="0 0 350 51" fill="none" xmlns="http://www.w3.org/2000/svg" class={styles.logoSvg}>
      <path d="M61.112 26.472C61.112 22.0347 62.072 18.088 63.992 14.632C65.912 11.1333 68.5787 8.424 71.992 6.504C75.448 4.54133 79.352 3.56 83.704 3.56C89.0373 3.56 93.6027 4.968 97.4 7.784C101.197 10.6 103.736 14.44 105.016 19.304H92.984C92.088 17.4267 90.808 15.9973 89.144 15.016C87.5227 14.0347 85.6667 13.544 83.576 13.544C80.2053 13.544 77.4747 14.7173 75.384 17.064C73.2933 19.4107 72.248 22.5467 72.248 26.472C72.248 30.3973 73.2933 33.5333 75.384 35.88C77.4747 38.2267 80.2053 39.4 83.576 39.4C85.6667 39.4 87.5227 38.9093 89.144 37.928C90.808 36.9467 92.088 35.5173 92.984 33.64H105.016C103.736 38.504 101.197 42.344 97.4 45.16C93.6027 47.9333 89.0373 49.32 83.704 49.32C79.352 49.32 75.448 48.36 71.992 46.44C68.5787 44.4773 65.912 41.768 63.992 38.312C62.072 34.856 61.112 30.9093 61.112 26.472ZM109.542 31.08C109.542 27.4107 110.225 24.1893 111.59 21.416C112.998 18.6427 114.897 16.5093 117.286 15.016C119.675 13.5227 122.342 12.776 125.286 12.776C127.803 12.776 130.001 13.288 131.878 14.312C133.798 15.336 135.27 16.68 136.294 18.344V13.288H147.238V49H136.294V43.944C135.227 45.608 133.734 46.952 131.814 47.976C129.937 49 127.739 49.512 125.222 49.512C122.321 49.512 119.675 48.7653 117.286 47.272C114.897 45.736 112.998 43.5813 111.59 40.808C110.225 37.992 109.542 34.7493 109.542 31.08ZM136.294 31.144C136.294 28.4133 135.526 26.2587 133.99 24.68C132.497 23.1013 130.662 22.312 128.486 22.312C126.31 22.312 124.454 23.1013 122.918 24.68C121.425 26.216 120.678 28.3493 120.678 31.08C120.678 33.8107 121.425 35.9867 122.918 37.608C124.454 39.1867 126.31 39.976 128.486 39.976C130.662 39.976 132.497 39.1867 133.99 37.608C135.526 36.0293 136.294 33.8747 136.294 31.144ZM166.1 19.24C167.38 17.2773 168.98 15.7413 170.9 14.632C172.82 13.48 174.953 12.904 177.3 12.904V24.488H174.292C171.561 24.488 169.513 25.0853 168.148 26.28C166.782 27.432 166.1 29.48 166.1 32.424V49H155.156V13.288H166.1V19.24ZM216.194 30.568C216.194 31.592 216.131 32.6587 216.003 33.768H191.235C191.405 35.9867 192.109 37.6933 193.347 38.888C194.627 40.04 196.184 40.616 198.019 40.616C200.749 40.616 202.648 39.464 203.715 37.16H215.363C214.765 39.5067 213.677 41.6187 212.099 43.496C210.563 45.3733 208.621 46.8453 206.275 47.912C203.928 48.9787 201.304 49.512 198.403 49.512C194.904 49.512 191.789 48.7653 189.059 47.272C186.328 45.7787 184.195 43.6453 182.659 40.872C181.123 38.0987 180.355 34.856 180.355 31.144C180.355 27.432 181.101 24.1893 182.595 21.416C184.131 18.6427 186.264 16.5093 188.995 15.016C191.725 13.5227 194.861 12.776 198.403 12.776C201.859 12.776 204.931 13.5013 207.619 14.952C210.307 16.4027 212.397 18.472 213.891 21.16C215.427 23.848 216.194 26.984 216.194 30.568ZM204.995 27.688C204.995 25.8107 204.355 24.3173 203.075 23.208C201.795 22.0987 200.195 21.544 198.275 21.544C196.44 21.544 194.883 22.0773 193.603 23.144C192.365 24.2107 191.597 25.7253 191.299 27.688H204.995ZM260.88 4.072V49H249.936V30.504H232.912V49H221.968V4.072H232.912V21.672H249.936V4.072H260.88ZM304.045 13.288V49H293.101V44.136C291.991 45.7147 290.477 46.9947 288.557 47.976C286.679 48.9147 284.589 49.384 282.285 49.384C279.554 49.384 277.143 48.7867 275.053 47.592C272.962 46.3547 271.341 44.584 270.189 42.28C269.037 39.976 268.461 37.2667 268.461 34.152V13.288H279.341V32.68C279.341 35.0693 279.959 36.9253 281.197 38.248C282.434 39.5707 284.098 40.232 286.189 40.232C288.322 40.232 290.007 39.5707 291.245 38.248C292.482 36.9253 293.101 35.0693 293.101 32.68V13.288H304.045ZM322.85 18.344C323.874 16.68 325.346 15.336 327.266 14.312C329.186 13.288 331.383 12.776 333.858 12.776C336.802 12.776 339.468 13.5227 341.858 15.016C344.247 16.5093 346.124 18.6427 347.49 21.416C348.898 24.1893 349.602 27.4107 349.602 31.08C349.602 34.7493 348.898 37.992 347.49 40.808C346.124 43.5813 344.247 45.736 341.858 47.272C339.468 48.7653 336.802 49.512 333.858 49.512C331.34 49.512 329.143 49.0213 327.266 48.04C325.388 47.016 323.916 45.672 322.85 44.008V49H311.906V1.64H322.85V18.344ZM338.466 31.08C338.466 28.3493 337.698 26.216 336.162 24.68C334.668 23.1013 332.812 22.312 330.594 22.312C328.418 22.312 326.562 23.1013 325.026 24.68C323.532 26.2587 322.786 28.4133 322.786 31.144C322.786 33.8747 323.532 36.0293 325.026 37.608C326.562 39.1867 328.418 39.976 330.594 39.976C332.77 39.976 334.626 39.1867 336.162 37.608C337.698 35.9867 338.466 33.8107 338.466 31.08Z" fill="var(--color-primary)"/>
      <path d="M0 10C0 4.47715 4.47715 0 10 0H33C38.5228 0 43 4.47715 43 10V31.3302C43 34.29 41.6888 37.0977 39.4194 38.9977L27.9194 48.6256C24.2048 51.7355 18.7952 51.7355 15.0806 48.6256L3.58063 38.9977C1.31117 37.0977 0 34.29 0 31.3302V10Z" fill="var(--color-primary)"/>
      <rect x="16.3845" y="9" width="10.3846" height="30" rx="2" fill="var(--brand-green-light)"/>
      <rect x="36" y="18.2307" width="10.3846" height="30" rx="2" transform="rotate(90 36 18.2307)" fill="var(--brand-green-light)"/>
    </svg>
  </div>

  <div class={styles.navContent} id="nav-content">
    <div class={styles.links}>
      <a href="#hero" data-nav-link>Home</a>
      <a href="#about" data-nav-link>À propos</a>
      <a href="#features" data-nav-link>Services</a>
      <a href="#reviews" data-nav-link>Témoignage</a>
      <a href="#pricing" data-nav-link>Tarifs</a>
      <a href="#faq" data-nav-link>FAQ</a>
    </div>

    <div class={styles.navRight}>
      <a
        href="https://github.com/aa-Aliane/carhub-"
        target="_blank"
        rel="noopener noreferrer"
        class={styles.githubLink}
        aria-label="GitHub"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="22"
          height="22"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"
          ></path>
        </svg>
      </a>

      <div class={styles.navCta}>
        <a href="#download" class={styles.btnNav}>Installer l'app</a>
      </div>
    </div>
  </div>

  <div class={styles.mobileActions}>
    <button
      id="theme-toggle"
      class={styles.themeToggle}
      aria-label="Changer de thème"
    >
      <svg
        class={styles.sun}
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        ><circle cx="12" cy="12" r="5"></circle><line
          x1="12"
          y1="1"
          x2="12"
          y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line
          x1="4.22"
          y1="4.22"
          x2="5.64"
          y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"
        ></line><line x1="1" y1="12" x2="3" y2="12"></line><line
          x1="21"
          y1="12"
          x2="23"
          y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"
        ></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg
      >
      <svg
        class={styles.moon}
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        ><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg
      >
    </button>
    <button class={styles.hamburger} id="hamburger" aria-label="Menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</nav>

<script>
  // --- LOGIQUE DARK MODE ---
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle('dark');

    const isDark = element.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  document
    .getElementById('theme-toggle')
    ?.addEventListener('click', handleToggleClick);

  // --- LOGIQUE MOBILE MENU ---
  const hamburger = document.getElementById('hamburger');
  const navContent = document.getElementById('nav-content');

  hamburger?.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    navContent?.classList.toggle('active');
    document.body.classList.toggle('menu-open');
  });

  // Fermer le menu au clic sur un lien
  const links = navContent?.querySelectorAll('a');
  links?.forEach(link => {
    link.addEventListener('click', () => {
      hamburger?.classList.remove('active');
      navContent?.classList.remove('active');
      document.body.classList.remove('menu-open');
    });
  });

  const navLinks = document.querySelectorAll('[data-nav-link]');
  const sections = document.querySelectorAll('section[id]');

  const observerOptions = {
    root: null,
    rootMargin: '-20% 0px -70% 0px',
    threshold: 0,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');

        navLinks.forEach((link) => {
          if (link.getAttribute('href') === `#${id}`) {
            link.setAttribute('data-active', 'true');
          } else {
            link.removeAttribute('data-active');
          }
        });
      }
    });
  }, observerOptions);

  sections.forEach((section) => observer.observe(section));

  const navbar = document.querySelector('nav');

  window.addEventListener('scroll', () => {
    if (navbar && window.scrollY > 50) {
      navbar.classList.add('scrolled');
    } else if (navbar) {
      navbar.classList.remove('scrolled');
    }
  });
</script>
