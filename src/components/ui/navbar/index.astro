---
// This is your index.astro inside components/ui/navbar/
import styles from './Navbar.module.css';
---

<nav class={styles.navbar}>
  <div class={styles.logo}>
    <span class={styles.plus}>+</span> CareHub
  </div>
  <div class={styles.links}>
    <a href="#hero" data-nav-link>Home</a>
    <a href="#about" data-nav-link>À propos</a>
    <a href="#features" data-nav-link>Services</a>
    <a href="#reviews" data-nav-link>Témoignage</a>
    <a href="#pricing" data-nav-link>Tarifs</a>
  </div>
  <div class={styles['nav-right']}>
    <button
      id="theme-toggle"
      class={styles.themeToggle}
      aria-label="Changer de thème"
    >
      <svg
        class={styles.sun}
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        ><circle cx="12" cy="12" r="5"></circle><line
          x1="12"
          y1="1"
          x2="12"
          y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line
          x1="4.22"
          y1="4.22"
          x2="5.64"
          y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"
        ></line><line x1="1" y1="12" x2="3" y2="12"></line><line
          x1="21"
          y1="12"
          x2="23"
          y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"
        ></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg
      >
      <svg
        class={styles.moon}
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        ><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg
      >
    </button>

    <div class={styles['nav-cta']}>
      <a href="#download" class={styles['btn-nav']}>Installer l'app</a>
    </div>
  </div>
</nav>

<script>
  // --- LOGIQUE DARK MODE ---
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle('dark');

    const isDark = element.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  document
    .getElementById('theme-toggle')
    ?.addEventListener('click', handleToggleClick);
  const navLinks = document.querySelectorAll<HTMLElement>('[data-nav-link]');
  const sections = document.querySelectorAll<HTMLElement>('section[id]');

  const observerOptions = {
    root: null,
    rootMargin: '-20% 0px -70% 0px',
    threshold: 0,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');

        navLinks.forEach((link) => {
          if (link.getAttribute('href') === `#${id}`) {
            link.setAttribute('data-active', 'true');
          } else {
            link.removeAttribute('data-active');
          }
        });
      }
    });
  }, observerOptions);

  sections.forEach((section) => observer.observe(section));

  const navbar = document.querySelector('nav'); // Cible ta navbar

  window.addEventListener('scroll', () => {
    if (navbar && window.scrollY > 50) {
      navbar.classList.add('scrolled');
    } else if (navbar) {
      navbar.classList.remove('scrolled');
    }
  });
</script>
